---
title: "Static Mapping with Markers"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 12,
  fig.height = 6
)
```

In [Getting Started with ggswim](https://chop-cgtinformatics.github.io/ggswim/articles/ggswim.html), we showcased how to add markers to a swimmer plot using "dynamic" mapping. This is a common use case, but not always the most applicable one. That's why ggswim caters to both dynamic and static marker assignments.

In this case, static marker assignment lets users call `add_marker()` and pass a single marker at a time with a manually defined color or shape as a parameter instead of passing a mapped column of values. Let's see how this works by splitting up `infusion_events` into distinct data frames.

```{r static mapping initial_infusions}
library(ggswim)

initial_infusions <- infusion_events |>
  dplyr::filter(infusion_type == "Infusion")

initial_infusions |>
  rmarkdown::paged_table()
```

```{r static mapping reinfusions}
reinfusions <- infusion_events |>
  dplyr::filter(infusion_type == "Reinfusion")

reinfusions |>
  rmarkdown::paged_table()
```

We'll start by setting up the same swimmer plot we've made from previous examples: 

```{r initial plot, message=FALSE, warning=FALSE}
p <- ggswim(
  data = patient_data |> dplyr::rename("Status Markers" = bcell_status),
  mapping = aes(x = delta_t0_months, y = pt_id, fill = disease_assessment_status)
) +
  # Same markers as before for Disease Assessment
  add_marker(
    aes(
      x = delta_t0_months,
      y = pt_id,
      color = `Status Markers`,
      shape = `Status Markers`
    ),
    size = 5, position = "identity", alpha = 1
  )
```

Now, building off of this, lets add out `initial_infusions` and `reinfusions` markers as separate calls to `add_marker()`:

```{r static plot no name, message=FALSE, warning=FALSE}
p +
  # New manual color markers for Infusions
  add_marker(
    data = initial_infusions,
    aes(x = infusion_delta_t0_months, y = pt_id),
    size = 5, position = "identity", color = "green"
  ) +
  add_marker(
    data = reinfusions,
    aes(x = infusion_delta_t0_months, y = pt_id),
    size = 5, position = "identity", color = "red"
  ) +
  theme_ggswim()
```

Notice here how we specified a `color` outside of `aes()`, but something's not right... Our infusions don't appear in the legend. In order to support static assignments in the legend, we also need to give a static name to the new data via a special `name` parameter.

```{r static plot name, message=FALSE, warning=FALSE}
p +
  # New manual color markers for Infusions
  add_marker(
    data = initial_infusions,
    aes(x = infusion_delta_t0_months, y = pt_id, name = "Initial Infusion"),
    size = 5, position = "identity", color = "green"
  ) +
  add_marker(
    data = reinfusions,
    aes(x = infusion_delta_t0_months, y = pt_id, name = "Reinfusion"),
    size = 5, position = "identity", color = "red"
  ) +
  theme_ggswim()
```
